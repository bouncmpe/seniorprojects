{{ $year := .Site.Params.year }}
{{ $semester := .Site.Params.semester }}

{{ $path := printf "semesters/%s-%s/" $year $semester }}

{{ $pages := slice }}

{{ range .Site.RegularPages }}
    {{ if hasPrefix .File.Dir $path }}
        {{ $pages = $pages | append . }}
    {{ end }}
{{ end }}

<script>
    const dynamicEls = [
        {{ range $pages }}
            {{ if .Params.poster }}
                {{ $image := .Resources.Get .Params.poster }}
                {
                    "src": '{{ $image.RelPermalink }}',
                        "sources": [
                        {
                            "type": "image/webp",
                            "srcset": {{ partial "srcset.html" (dict "image" $image "type" " webp")}},
                            "sizes": "(min-width: 800px) 80vw, 100vw"
                        },
                        {
                            "type": "image/jpeg",
                            "srcset": {{ partial "srcset.html" (dict "image" $image "type" " jpg")}},
                            "sizes": "(min-width: 800px) 80vw, 100vw"
                        }
                    ],
                    'subHtml': '<div class="container subHTML bg-black">' + 
                        '<a href="{{ .RelPermalink }}"><h3 class="fw-bold pt-2">{{ .Title }}</h3></a>' +
                        '<p class="subhead mt-1 fs-6">{{ .Summary }}</p>' +
                        '<div class="post-author d-flex justify-content-center mt-3">{{ partial "students.html" (dict "students" .Params.students) }}</div>' +
                    '</div>'
                },
            {{ end }}
        {{ end }}
    ]

    window.addEventListener("load", () => {
        const $dynamicGallery = document.getElementById('digest-button');
        if (window.lightGallery) {
            const dynamicGallery = window.lightGallery(document.getElementById('digest-button'), {
                dynamic: true,
                dynamicEl: dynamicEls,
                plugins: [window.lgVideo, window.lgZoom],
                preload: 0
            })
            $dynamicGallery.addEventListener('click', function () {
                dynamicGallery.openGallery();
            });
        }
    });
</script>