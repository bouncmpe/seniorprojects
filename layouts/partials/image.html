{{- $respSizes := slice "160" "320" "600" "960" "1280" "1600" "1920" -}}

{{ $image := resources.Get .src }}
{{- $actualImg := $image.Resize "640x jpg" -}}

<picture>
    <source
        type="image/webp"
        srcset="
        {{- with $respSizes -}}
            {{- range $i, $e := . -}}
                {{- if ge $image.Width . -}}
                    {{- if $i }}, {{ end -}}{{- ($image.Resize (printf "%sx%s" . " webp") ).RelPermalink }} {{ . }}w
                {{- end -}}
            {{- end -}}
        {{- end -}}"
        sizes="{{ .sizes }}"
    />
    <source
        type="image/jpeg"
        srcset="
        {{- with $respSizes -}}
            {{- range $i, $e := . -}}
                {{- if ge $image.Width . -}}
                    {{- if $i }}, {{ end -}}{{- ($image.Resize (printf "%sx%s" . " jpg") ).RelPermalink }} {{ . }}w
                {{- end -}}
            {{- end -}}
        {{- end -}}"
        sizes="{{ .sizes }}"
    />
    <img class="{{ .classes }}"
        src="{{ $actualImg.RelPermalink }}"
        width="{{ $image.Width }}"
        height="{{ $image.Height }}"
        alt="{{ .alt }}"
        loading="lazy"
    />
</picture>
